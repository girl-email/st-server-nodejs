import {App, Inject} from '@midwayjs/decorator';
import { Provide} from '@midwayjs/core';
// import { ILogger } from '@midwayjs/logger';
const rp = require('request-promise');

// @ts-ignore
import Youdao from '@opentranslate/youdao'
// @ts-ignore
const Youdao = require('youdao-fanyi');
import fetch from 'node-fetch'
import * as koa from "@midwayjs/koa";
const fs = require('fs')
import { MidwayLoggerService } from '@midwayjs/core';
const dayjs = require('dayjs')

@Provide()
export class JDService {
    constructor(cookies) {
        // this.JDCookies = cookies
        setTimeout(() => {
            this.init()
        },2000)
    }
    @Inject()
    loggerService: MidwayLoggerService;

    @App()
    app: koa.Application;

    // @Logger()
    // logger: ILogger;
    thread = null

    logger = {
        info: console.log
    }
    // public  JDCookies = "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; smb_track=68FA65B2AC0940C580281397D309CBF3; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMTJL3GFYAAAAADNLQB5PBUZY27AX; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFMPE2E4JNGURJMD6BG2WHDMBHT4EQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; __jda=34491710.1700109613209731139267.1700109613.1703401863.1703405033.10; __jdb=34491710.3.1700109613209731139267|10.1703405033; __jdc=34491710; shshshfpb=AAspC2pqMEpILfXnDP1RQdOco4vsSWBcDNClSQwAAAAA"
    // public JDCookies =  'shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLG3OYXDZPC55WIFM2KMZTU5JUJAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURZJPHE5NZCGUSHOQQABJRWYI677CRIWDHHMRN4KSSUAJ753HZ5CVXRYBWLGGM5JRGBV4QYIYJWSBRWA7733MGAENNJ56QAMOWNZE6ZSSTAQTFHU37QBUJYDBEKWJYAA5WPGV6SWRTDLSI5CHEPVDR4UNBRRZSCXOYZJO7ATLK7RGPS5HRFAM5S7HXKTKG6NOB34BWWETDIYHXWWFHTO6LEZBXPNS3VOFOJJX767T7ELKOY4J5X326W5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMTQJ5ZFAAAAAADWK2RUZEJMQUR4X; smb_track=011F121D15A04EE59AFBF003E59A3A99; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; shshshfpb=AAhxYXpyMEpILfXnDP1RQdOco4vsSWBcDNClSSQAAAAA; __jda=191429163.1700109613209731139267.1700109613.1703425336.1703430469.14; __jdc=191429163; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFKJAMC6VMFUCXSOQQJI7LRSAV7FEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BT6J5QHW4NHEO2FQD3BY4EQENP5Q; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUW5SGJDPMVKMN2L5WPPV2OFWKXT7DONKSVFDJCTNXMRSI33FKTDOS7NT35OTRNSV43YCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUV6VYTQKDWKCEX3KK3AHZBBXYFWM; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; __jdb=191429163.24.1700109613209731139267|14.1703430469'
    // public JDCookies =  "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLG3OYXDZPC55WIFM2KMZTU5JUJAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURZJPHE5NZCGUSHOQQABJRWYI677CRIWDHHMRN4KSSUAJ753HZ5CVXRYBWLGGM5JRGBV4QYIYJWSBRWA7733MGAENNJ56QAMOWNZE6ZSSTAQTFHU37QBUJYDBEKWJYAA5WPGV6SWRTDLSI5CHEPVDR4UNBRRZSCXOYZJO7ATLK7RGPS5HRFAM5S7HXKTKG6NOB34BWWETDIYHXWWFHTO6LEZBXPNS3VOFOJJX767T7ELKOY4J5X326W5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; smb_track=011F121D15A04EE59AFBF003E59A3A99; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; shshshfpb=AAleb2J6MEpILfXnDP1RQdOco4vsSWBcDNClSTAAAAAA; mba_muid=1700109613209731139267; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMT5HA7YIAAAAAC3CRC5WR62G7GIX; __jda=191429163.1700109613209731139267.1700109613.1703476308.1703479749.17; __jdc=191429163; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFM2V273BK2INZG6MDLBV7RUJ76MEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUSXGZMN3TO5GPFPI2IZSRELZ4W67DONKSVFDJCTMVZWLDO43XJTZL2GSGMUJC6PFXTYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUV7M4Y6AWHP3TXYVY3BDOXDS4SZM; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BT4JZUW7IYOJSQIOCGFXSEMEN6TI; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; __jdb=191429163.12.1700109613209731139267|17.1703479749"
    // public JDCookies = "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLG3OYXDZPC55WIFM2KMZTU5JUJAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURZJPHE5NZCGUSHOQQABJRWYI677CRIWDHHMRN4KSSUAJ753HZ5CVXRYBWLGGM5JRGBV4QYIYJWSBRWA7733MGAENNJ56QAMOWNZE6ZSSTAQTFHU37QBUJYDBEKWJYAA5WPGV6SWRTDLSI5CHEPVDR4UNBRRZSCXOYZJO7ATLK7RGPS5HRFAM5S7HXKTKG6NOB34BWWETDIYHXWWFHTO6LEZBXPNS3VOFOJJX767T7ELKOY4J5X326W5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; smb_track=011F121D15A04EE59AFBF003E59A3A99; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; shshshfpb=AAleb2J6MEpILfXnDP1RQdOco4vsSWBcDNClSTAAAAAA; mba_muid=1700109613209731139267; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMT5HA7YIAAAAAC3CRC5WR62G7GIX; __jdc=191429163; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFM2V273BK2INZG3PLZ2YEBJ4HYMEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BT67KAFJECU4EAFUZXBB73KUH75Y; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUSXGZMN3TO5GPFC6HNGGIFH4VB47DONKSVFDJCTMVZWLDO43XJTZIXR3JRSBJ7FIPDYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVUDW4B7XIMC6V5QLBXGHTIO5M64; __jda=191429163.1700109613209731139267.1700109613.1703479749.1703483900.18; __jdb=191429163.2.1700109613209731139267|18.1703483900"
    // public JDCookies =  "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLG3OYXDZPC55WIFM2KMZTU5JUJAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURZJPHE5NZCGUSHOQQABJRWYI677CRIWDHHMRN4KSSUAJ753HZ5CVXRYBWLGGM5JRGBV4QYIYJWSBRWA7733MGAENNJ56QAMOWNZE6ZSSTAQTFHU37QBUJYDBEKWJYAA5WPGV6SWRTDLSI5CHEPVDR4UNBRRZSCXOYZJO7ATLK7RGPS5HRFAM5S7HXKTKG6NOB34BWWETDIYHXWWFHTO6LEZBXPNS3VOFOJJX767T7ELKOY4J5X326W5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; smb_track=011F121D15A04EE59AFBF003E59A3A99; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; shshshfpb=AAleb2J6MEpILfXnDP1RQdOco4vsSWBcDNClSTAAAAAA; mba_muid=1700109613209731139267; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMT5HA7YIAAAAAC3CRC5WR62G7GIX; __jdc=191429163; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFM2V273BK2INZG3PLZ2YEBJ4HYMEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BT67KAFJECU4EAFUZXBB73KUH75Y; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUSXGZMN3TO5GPFC6HNGGIFH4VB47DONKSVFDJCTMVZWLDO43XJTZIXR3JRSBJ7FIPDYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVUDW4B7XIMC6V5QLBXGHTIO5M64; __jda=191429163.1700109613209731139267.1700109613.1703479749.1703483900.18; __jdb=191429163.2.1700109613209731139267|18.1703483900"
    public JDCookies  =  "language=zh_CN; __jdv=56585130|direct|-|none|-|1703600265575; pinId=Mk_A6Nbv7MenkDneLmJDcA; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; ceshi3.com=000; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; __jdu=17036002655721718781778; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; flash=2_gIf-6hV0n-3D-owJHuVRpoG10QbYhFqtf8iq_PAPhP_zARQSoNehkDTUKX2bRosNurZi5lwdeYPjJ6lyjjCj6DfYmyPcMhCrz4uSJ8Kexsq*; TrackID=1ZSq5cEcVwiknpIRBT-fNmlAXfS_Vw6wS43RS8OYzM1HL5lsU9ffdVyq7YqBUIo-a; thor=6901B38FCABE2222F893FE4DA6A41AD2E3C483C9683B39E7396B71698DCB11C14EC8CD85133AC917234988D59EE06B23F7FEF3328DD8ADAFC4EAB61C5186AE21E4701CF1263EB28EDD024710F49B0ECD72FD38E9917280EDE8E802A8F5CDEC75B3A323ADC1B43DFB4FB87AB43993FE1C74AFBCBF673834D99FD3094B90C3789565784C8BCE4E664302CF9229EC53115B; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLE66HGX6H6FTDBCGJT2CHIQVGBEALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURYZVWQPSCD3VDH4ZBLXMMUXPQJVVPYTHZOTYSQGOZPT3VJVDPGXA56A3LCJRUMD33LCTZXPFSMQ3XWZN2XCXEU377PYBSOJ5KDPWYFTXBCW4XVKE32CJKDJPI6QP6QVQYT5GF65B3DWLM6EW57FJQBO6Q762KFYJFVOUQ3HS27ZJL7T2BV2L72ABR2ZXET3GKM3JAUMD6LEL6M7JBTCI4GVDBYSZ7BSSE6PVI7NJIBQV5MVVI6CUJN7K7J2L4XHGOBDC35OONJCFTROGKKKV2WQVCB4JRYRBOMWGBWLI54R5PAXPC62DI; b-sec=H7A3ZVYOXG5O6CIG7HQL4J7UIHCOAOXSWXVJGQ6BOBAGYGTIVDEJSOPSWOPURFK5; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUWP66XJIZDXBYZKDAO54T5BBWUA7DONKSVFDJCTNT7XV2KGI5YOGKQYDXPE7IINVADYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVQ3LK46TGOU55INQYNJ63G3NK4M; universityLanguage=zh_CN; xue_userTypeCookieName50b60fba08fddfff319d0b5acc9d6eee=\"{\\\"1\\\":\\\"POP\\\"}\"; xue_userTypePageCookieName50b60fba08fddfff319d0b5acc9d6eee=1; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFNRRRQCPZ7EBOWHANCWVFJHFVSTEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; __jda=191429163.17036002655721718781778.1703600266.1703729497.1703749795.11; __jdc=191429163; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BSMLEHDIVX2QBZKIZSDNVQVV6ZDQ; __jdb=191429163.18.17036002655721718781778|11.1703749795; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU"

    // public JDCookies =  "";

    private beiAnList = [];

    public stopList = [];

    public stopListBak = []

    // 检查频次
    CHECK_TIME = 1000 * 30

    init() {

        // const customLogger = this.loggerService.getLogger('coreLogger');
        // this.logger = customLogger
        this.logger.info('初始化');
        this.getStopOrderList()
        // this.getBeiAnList()

        // setInterval(() => {
        //     this.logger.info('开始新的一轮暂停订单检查');
        //     this.getStopOrderList()
        // }, this.CHECK_TIME)
        //
        // setInterval(() => {
        //     this.getSendOrderList()
        // }, this.CHECK_TIME * 1.5)
    }

    // 获取暂停的订单列表
    async getStopOrderList() {
        try {
            console.log("开始新的一轮暂停订单检查")
            // const res = await fetch("https://porder.shop.jd.com/order/orderlist", {
            //     "headers": {
            //         "accept": "application/json, text/plain, */*",
            //         "accept-language": "zh-CN,zh;q=0.9,en;q=0.8",
            //         "content-type": "application/json;charset=UTF-8",
            //         "sec-ch-ua-platform": "\"macOS\"",
            //         "sec-fetch-dest": "empty",
            //         "sec-fetch-mode": "cors",
            //         "sec-fetch-site": "same-origin",
            //         // "sgm-context": "151453342848281150;151453342848281150",
            //         // "cookie": "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLG3OYXDZPC55WIFM2KMZTU5JUJAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURZJPHE5NZCGUSHOQQABJRWYI677CRIWDHHMRN4KSSUAJ753HZ5CVXRYBWLGGM5JRGBV4QYIYJWSBRWA7733MGAENNJ56QAMOWNZE6ZSSTAQTFHU37QBUJYDBEKWJYAA5WPGV6SWRTDLSI5CHEPVDR4UNBRRZSCXOYZJO7ATLK7RGPS5HRFAM5S7HXKTKG6NOB34BWWETDIYHXWWFHTO6LEZBXPNS3VOFOJJX767T7ELKOY4J5X326W5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; smb_track=011F121D15A04EE59AFBF003E59A3A99; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; shshshfpb=AAleb2J6MEpILfXnDP1RQdOco4vsSWBcDNClSTAAAAAA; mba_muid=1700109613209731139267; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMT5HA7YIAAAAAC3CRC5WR62G7GIX; __jdc=191429163; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFM2V273BK2INZG3PLZ2YEBJ4HYMEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BT67KAFJECU4EAFUZXBB73KUH75Y; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUSXGZMN3TO5GPFC6HNGGIFH4VB47DONKSVFDJCTMVZWLDO43XJTZIXR3JRSBJ7FIPDYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVUDW4B7XIMC6V5QLBXGHTIO5M64; __jda=191429163.1700109613209731139267.1700109613.1703479749.1703483900.18; __jdb=191429163.2.1700109613209731139267|18.1703483900",
            //         "Referer": `https://porder.shop.jd.com/order/orderlist/suspend?t=1703595540199`,
            //         "Referrer-Policy": "strict-origin-when-cross-origin",
            //         "cookie": this.JDCookies
            //     },
            //     "body": "{\"current\":1,\"pageSize\":10,\"selectedTabName\":\"suspend\",\"sortName\":\"desc\"}",
            //     "method": "POST"
            // })


            const res = await fetch("https://porder.shop.jd.com/order/orderlist", {
                "headers": {
                    "accept": "application/json, text/plain, */*",
                    "accept-language": "zh-CN,zh;q=0.9,en;q=0.8",
                    "content-type": "application/json;charset=UTF-8",
                    "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
                    "sec-ch-ua-mobile": "?0",
                    "sec-ch-ua-platform": "\"macOS\"",
                    "sec-fetch-dest": "empty",
                    "sec-fetch-mode": "cors",
                    "sec-fetch-site": "same-origin",
                    // "cookie": "language=zh_CN; __jdv=56585130|direct|-|none|-|1703600265575; pinId=Mk_A6Nbv7MenkDneLmJDcA; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; ceshi3.com=000; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; __jdu=17036002655721718781778; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; flash=2_gIf-6hV0n-3D-owJHuVRpoG10QbYhFqtf8iq_PAPhP_zARQSoNehkDTUKX2bRosNurZi5lwdeYPjJ6lyjjCj6DfYmyPcMhCrz4uSJ8Kexsq*; TrackID=1ZSq5cEcVwiknpIRBT-fNmlAXfS_Vw6wS43RS8OYzM1HL5lsU9ffdVyq7YqBUIo-a; thor=6901B38FCABE2222F893FE4DA6A41AD2E3C483C9683B39E7396B71698DCB11C14EC8CD85133AC917234988D59EE06B23F7FEF3328DD8ADAFC4EAB61C5186AE21E4701CF1263EB28EDD024710F49B0ECD72FD38E9917280EDE8E802A8F5CDEC75B3A323ADC1B43DFB4FB87AB43993FE1C74AFBCBF673834D99FD3094B90C3789565784C8BCE4E664302CF9229EC53115B; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLE66HGX6H6FTDBCGJT2CHIQVGBEALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURYZVWQPSCD3VDH4ZBLXMMUXPQJVVPYTHZOTYSQGOZPT3VJVDPGXA56A3LCJRUMD33LCTZXPFSMQ3XWZN2XCXEU377PYBSOJ5KDPWYFTXBCW4XVKE32CJKDJPI6QP6QVQYT5GF65B3DWLM6EW57FJQBO6Q762KFYJFVOUQ3HS27ZJL7T2BV2L72ABR2ZXET3GKM3JAUMD6LEL6M7JBTCI4GVDBYSZ7BSSE6PVI7NJIBQV5MVVI6CUJN7K7J2L4XHGOBDC35OONJCFTROGKKKV2WQVCB4JRYRBOMWGBWLI54R5PAXPC62DI; b-sec=H7A3ZVYOXG5O6CIG7HQL4J7UIHCOAOXSWXVJGQ6BOBAGYGTIVDEJSOPSWOPURFK5; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUWP66XJIZDXBYZKDAO54T5BBWUA7DONKSVFDJCTNT7XV2KGI5YOGKQYDXPE7IINVADYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVQ3LK46TGOU55INQYNJ63G3NK4M; universityLanguage=zh_CN; xue_userTypeCookieName50b60fba08fddfff319d0b5acc9d6eee=\"{\\\"1\\\":\\\"POP\\\"}\"; xue_userTypePageCookieName50b60fba08fddfff319d0b5acc9d6eee=1; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFNRRRQCPZ7EBOWHANCWVFJHFVSTEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; __jda=191429163.17036002655721718781778.1703600266.1703729497.1703749795.11; __jdc=191429163; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BSMLEHDIVX2QBZKIZSDNVQVV6ZDQ; __jdb=191429163.18.17036002655721718781778|11.1703749795; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU",
                    "cookie": this.JDCookies,
                        "Referer": "https://porder.shop.jd.com/order/orderlist/suspend?t=1703750321517",
                    "Referrer-Policy": "strict-origin-when-cross-origin"
                },
                "body": "{\"current\":1,\"pageSize\":10,\"sortName\":\"desc\",\"orderId\":\"\",\"skuName\":\"\",\"orderCreateDateRange\":[],\"orderCompleteDateRange\":[],\"receiverName\":\"\",\"receiverTel\":\"\",\"userPin\":\"\",\"skuId\":\"\",\"logiNo\":\"\",\"paymentType\":\"\",\"orderType\":\"\",\"orderSource\":\"\",\"deliveryType\":\"\",\"storeId\":\"\",\"huoHao\":\"\",\"orderStatusArray\":[],\"o2oStoreIds\":null,\"provinceIds\":[],\"orderTag\":null,\"selectedTabName\":\"suspend\"}",
                "method": "POST"
            }).then(d => {
                try {
                    return d.json()
                } catch (e) {
                    return d.text()
                }
            });
            if (Array.isArray(res.orderList)) {
                this.logger.info('京东可以访问', this.thread)
            } else {
                this.logoutNotify(res)
                this.logger.info('登录过期', this.thread)
            }
            this.stopListBak = [...this.stopList]
            this.stopList = res.orderList || [];

            const jumpList = [];
            for (const j of this.stopListBak) {
                const order = this.stopList.find(item => item.orderId == j.orderId)
                if (!order) {
                    jumpList.push(j)
                }
            }
            // 需要变更状态的订单列表
            if (jumpList.length > 0) {
                console.log('DIFF订单, 需要变更状态')
                for (const item of jumpList) {
                    const orderItems = item.orderItems;
                    for (const order of orderItems) {
                        const skuId = order.skuId
                        const info = await this.queryOneBeiAnInfo(skuId)
                        if (info) {
                            info.orderId = item.orderId
                            info.paymentConfirmTime = item.paymentConfirmTime
                            const success = await this.updateBeiAn(info, 1)
                            if (success) {
                                this.jumpSendFeiShu(
                                    {
                                        ...info,
                                        skuName: order.skuName
                                    },
                                    1
                                )

                            }
                        }
                    }
                }
            }

            for await (const item of this.stopList) {
                const orderItems = item.orderItems;
                // "orderStatus": -4,
                //     isPhoneOrder: false
                if (item.orderStatus === -4) {
                    continue;
                }
                for await (const order of orderItems) {
                    const skuId = order.skuId
                    const info = await this.queryOneBeiAnInfo(skuId)
                    if(!info) continue;
                    info.orderId = item.orderId
                    info.paymentConfirmTime = item.paymentConfirmTime
                    // this.stopList.splice(this.stopList.findIndex(j => j.id == item.id), 1, {
                    //     ...
                    // })
                    order.mainSkuId = info.skuId
                    if (info.type == 1) {
                        const success = await this.updateBeiAn(info, 0);
                        if (success) {
                            this.sendFeiShu(
                                {
                                    ...info,
                                    skuName: order.skuName
                                }
                                , 0)
                        }
                    }
                }
            }
            setTimeout(() => {
                this.getSendOrderList()
            },10000)
            return  {
                res,
            }
        } catch (e) {
            console.log(e, 'error, stop Order')
            setTimeout(() => {
                this.getSendOrderList()
            },5000)
        }
    }
    // 获取备列表
    async getBeiAnList(page = 1) {
        try {
            const result = await fetch("https://shop-hk.jd.com/popRecording/recorded/recordedManage.do?goodsName=&skuId=&upc=&customId=&fromCreated=&toCreated=&ccProvider=&customModel=&sellerRecord=&page=1", {
                "headers": {
                    "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
                    // "cookie": "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; corpBehavior=1; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMUOJ4NGQAAAAADSDP22VJIM6GNMX; cn=1; smb_track=E36463B1BA744C75803892A14AFFF0A9; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; TrackID=1eKDqnXkB0cCNjshjVGs7kkRuDN5_Qha45E8IfuM0IyGXJFm6xN_gwllHHQ4ocw_w; ceshi3.com=000; flash=2_3Vf3TU1oOHS1E3iLb5mioPPwrQ-L6JvcRzupMoYFEjuZidy3aoJAiw6EkDNkfqvzrWbw1ymxXXb9Xid3ms_lM599f059_YoIpxgLpMYfYkp*; thor=6901B38FCABE2222F893FE4DA6A41AD28B2FF5A6B6F54A76F64CA788BC1404FA432D8014F1CA9DE928F379133D2969B553703BE185EF1FD6649B263A5EA1B9472C6558C7D6FE5CD726F9BF383E4E4570D054429AC8A045F0B45922B76DF266888E87D583C7DF1F76D301771EF3F104D797CDE992C8421711685C97D73408EC5147BF2E12DEF84BD9DEDF129C6C483F90; b-sec=H7A3ZVYOXG5O6CIG7HQL4J7UIHCOAOXSWXVJGQ2SINZCR5RT55BV5YF3H32UFC4S; mba_muid=1700109613209731139267; universityLanguage=zh_CN; xue_userTypeCookieName50b60fba08fddfff319d0b5acc9d6eee=\"{\\\"1\\\":\\\"POP\\\"}\"; xue_userTypePageCookieName50b60fba08fddfff319d0b5acc9d6eee=1; qid_uid=63fbf91a-2193-4141-8127-0b5a9a4da60e; qid_fs=1703595716678; qid_ls=1703595716678; qid_ts=1703595716684; qid_vis=1; shshshfpb=AAsaEOaaMEpILfXnDP1RQdOco4vsSWBcDNClSTgAAAAA; __jdc=191429163; __jda=191429163.1700109613209731139267.1700109613.1703595081.1703597990.29; __jdb=191429163.4.1700109613209731139267|29.1703597990; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFOSH3SMBJJZ724KPLBMR6EIVFPXEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A",
                    "cookie": this.JDCookies,
                        "Referer": "https://shop-hk.jd.com/popRecording/recorded/recorded.html",
                    "Referrer-Policy": "strict-origin-when-cross-origin"
                },
                "body": null,
                "method": "GET"
            }).then(d => {
                return d.json()
            });

            const res = result.result.result;
            const list = res.list;
            this.beiAnList.push(...list)
            for (const item of list) {
                const info = await this.queryOneBeiAnInfo(item.skuId)
                if (info && info.type == 0) {
                    await this.updateBeiAn(info, 1);
                }
            }
            if (page < res.totalPage) {
                setTimeout(() => {
                    this.getBeiAnList(res.page + 1)
                }, 2000)
            } else {
                console.log('执行完成')
            }

        } catch (e) {
            console.log(e, 'getBeiAnList')
            this.getBeiAnList(1)
        }
        // list.forEach(item => {
        //     if (item.type === 1) {
        //         console.log('type 1')
        //     }
        // })
        // console.log(res,list, '--');
    }
    /**
     *
     * @param skuId
     */
    async queryOneBeiAnInfo(skuId) {
        try {
            const result = await fetch(`https://shop-hk.jd.com/popRecording/recorded/recordedManage.do?goodsName=&skuId=${skuId}&upc=&customId=&fromCreated=&toCreated=&ccProvider=&customModel=&sellerRecord=&page=1`, {
                "headers": {
                    "accept": "*/*",
                    // "accept-language": "zh-CN,zh;q=0.9,en;q=0.8",
                    "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
                    // "sec-ch-ua-mobile": "?0",
                    // "sec-ch-ua-platform": "\"macOS\"",
                    // "sec-fetch-dest": "empty",
                    // "sec-fetch-mode": "cors",
                    // "sec-fetch-site": "same-origin",
                    // "x-requested-with": "XMLHttpRequest",
                    // "cookie": "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; smb_track=68FA65B2AC0940C580281397D309CBF3; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMTJL3GFYAAAAADNLQB5PBUZY27AX; shshshfpb=AAjDfXpqMEpILfXnDP1RQdOco4vsSWBcDNClSQQAAAAA; __jda=191429163.1700109613209731139267.1700109613.1703385126.1703396104.8; __jdc=191429163; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFIC5X344XUJBUB4ERW6SKYGMVMNEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU",
                    "Referer": "https://shop-hk.jd.com/popRecording/recorded/recorded.html",
                    "Referrer-Policy": "strict-origin-when-cross-origin",
                    "cookie": this.JDCookies
                },
                "body": null,
                "method": "GET"
            }).then(d => d.json());

            const info = result.result.result.list[0];
            if (info && info.mainSkuId) {
                return  await this.queryOneBeiAnInfo(info.mainSkuId)
            }
            return  info
        } catch (e) {
            console.log(e, 'error info')
            return  null
        }
    }
    // 获取下一阶段订单列表
    async getSendOrderList() {
        try {
            const result = await fetch("https://porder.shop.jd.com/order/orderlist", {
                "headers": {
                    "accept": "application/json, text/plain, */*",
                    "accept-language": "zh-CN,zh;q=0.9,en;q=0.8",
                    "content-type": "application/json;charset=UTF-8",
                    "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
                    "sec-ch-ua-mobile": "?0",
                    "sec-ch-ua-platform": "\"macOS\"",
                    "sec-fetch-dest": "empty",
                    "sec-fetch-mode": "cors",
                    "sec-fetch-site": "same-origin",
                    "cookies": this.JDCookies,
                    // "cookie": "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; corpBehavior=1; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMUOJ4NGQAAAAADSDP22VJIM6GNMX; cn=1; smb_track=E36463B1BA744C75803892A14AFFF0A9; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; TrackID=1eKDqnXkB0cCNjshjVGs7kkRuDN5_Qha45E8IfuM0IyGXJFm6xN_gwllHHQ4ocw_w; ceshi3.com=000; flash=2_3Vf3TU1oOHS1E3iLb5mioPPwrQ-L6JvcRzupMoYFEjuZidy3aoJAiw6EkDNkfqvzrWbw1ymxXXb9Xid3ms_lM599f059_YoIpxgLpMYfYkp*; thor=6901B38FCABE2222F893FE4DA6A41AD28B2FF5A6B6F54A76F64CA788BC1404FA432D8014F1CA9DE928F379133D2969B553703BE185EF1FD6649B263A5EA1B9472C6558C7D6FE5CD726F9BF383E4E4570D054429AC8A045F0B45922B76DF266888E87D583C7DF1F76D301771EF3F104D797CDE992C8421711685C97D73408EC5147BF2E12DEF84BD9DEDF129C6C483F90; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLCVF5BI7BM6KSTB3TNH3PMYY5YAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURYZVWQPSCD3VDHMYA4TRS3V45TKL5WWCWLZJGL3O3E5ZV4ATZXW4SB4DJLYX2W5LCD463NVMESRXHGU7GPWC3OZ52TBSZVWNCCHLV74FF3X42RWEHORBFKVKO32KKWLMWICL5FHXUEAUU7DLZ7R7TMBK7WVVS3WBDRRYD2QA22CEXPI3DTY7JDOMGER4JRG54GG4GSVXV6ABW2A3EP2IIDQ3SSPF25JGU5EUCCQ4J6ZPZ4Z664WWOW5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; b-sec=H7A3ZVYOXG5O6CIG7HQL4J7UIHCOAOXSWXVJGQ2SINZCR5RT55BV5YF3H32UFC4S; mba_muid=1700109613209731139267; universityLanguage=zh_CN; xue_userTypeCookieName50b60fba08fddfff319d0b5acc9d6eee=\"{\\\"1\\\":\\\"POP\\\"}\"; xue_userTypePageCookieName50b60fba08fddfff319d0b5acc9d6eee=1; qid_uid=63fbf91a-2193-4141-8127-0b5a9a4da60e; qid_fs=1703595716678; qid_ls=1703595716678; qid_ts=1703595716684; qid_vis=1; shshshfpb=AAsaEOaaMEpILfXnDP1RQdOco4vsSWBcDNClSTgAAAAA; __jdc=191429163; __jda=191429163.1700109613209731139267.1700109613.1703595081.1703597990.29; __jdb=191429163.4.1700109613209731139267|29.1703597990; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFOSH3SMBJJZ724KPLBMR6EIVFPXEQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUTU42R6YB2W5VZ6EM4KMCDPPN6Q7DONKSVFDJCTM5HGUPWAOVXNOPRDHCTAQ333PUDYCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVZUSD7QTIF7XR3TDIEYQPVXQMOE; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BTVDMR2XFT7UKF2SGMJ2HHVPJWUA",
                    "Referer": "https://porder.shop.jd.com/order/orderlist/waitOverseasOut?t=1703647807211",
                    "Referrer-Policy": "strict-origin-when-cross-origin"
                },
                "body": "{\"current\":1,\"pageSize\":10,\"sortName\":\"desc\",\"orderId\":\"\",\"skuName\":\"\",\"orderCreateDateRange\":[],\"orderCompleteDateRange\":[],\"receiverName\":\"\",\"receiverTel\":\"\",\"userPin\":\"\",\"skuId\":\"\",\"logiNo\":\"\",\"paymentType\":\"\",\"orderType\":\"\",\"orderSource\":\"\",\"deliveryType\":\"\",\"storeId\":\"\",\"huoHao\":\"\",\"orderStatusArray\":[],\"o2oStoreIds\":null,\"provinceIds\":[],\"orderTag\":null,\"selectedTabName\":\"waitOverseasOut\"}",
                "method": "POST"
            }).then(d => {
                return  d.json()
            }).catch(err => {
                console.log(err)
            });
            const orderList = result.orderList;
            for await (const item of orderList) {
                const orderItems = item.orderItems;
                for (const order of orderItems) {
                    const skuId = order.skuId
                    const hasSkuInStop = this.stopListHasSku(skuId);
                    if (!hasSkuInStop) {
                        const info = await this.queryOneBeiAnInfo(skuId)
                        if(!info) continue
                        const hasSkuInStop = this.stopListHasSku(info.skuId);
                        if (!hasSkuInStop && info && info.type == 0) {
                            await this.updateBeiAn(info, 1)
                        }
                    }
                }
            }

            setTimeout(() => {
                this.getStopOrderList()
            },15000)
        } catch (e) {
            setTimeout(() => {
                this.getStopOrderList()
            },5000)
        }
        // const now = Date.now()
    }
    // 更新备案
    async updateBeiAn(info1, type = 1) {
        let info = {
            "id": 16193866,
            "operationSign": 1,
            "rejectInfo": null,
            "operationSource": null,
            "status": 0,
            "statusStr": "已备案",
            "statusPending": null,
            "operation": 4,
            "operationStr": null,
            "skuId": "10084463187057",
            "upc": "03145891741057",
            "emgSkuId": null,
            "taxCommitmentsway": "0",
            "goodsName": "香奈儿（Chanel）可可小姐炫色口红coco bloom银黑细管唇膏送女友礼物",
            "goodsNameEn": "Chanel Coco Chanel Colorful Lipstick Coco Bloom Silver Black Tubular lipstick Gifts to Girlfriend",
            "brand": "香奈儿",
            "brandEn": "Chanel",
            "xingHao": "无",
            "spe": "3g/支",
            "unit": "支",
            "goodsSellerPrice": "389",
            "grossWeight": 0.004,
            "netWeight": 0.003,
            "actualWeight": null,
            "volume": "",
            "safeDays": "",
            "salesWebSite": "",
            "goodsPicture": "",
            "goodsData": "",
            "goodsAttach": "",
            "hsCode": "3304100091",
            "hgsbys": "0:香奈儿|1:13%|2:日用|3:盒装|4:香奈儿|5:58|6:3g/支|7:3g/支|8:3g/支",
            "function": "无",
            "use": "无",
            "composition": "无",
            "vatRate": 13,
            "taxRate": 0,
            "originCountry": "法国",
            "originArea": "法国；产品批次不同，产品产地以实物为准",
            "manufacturer": "法国；产品批次不同，产品产地以实物为准",
            "roduceAddress": "",
            "supplier": "",
            "note": "",
            "venderId": 13998334,
            "eclpCode": "EBU4418055094368",
            "eclpName": "INCOROYTRADELIMITED",
            "customModel": "zhiyou",
            "customModelName": "保税直邮",
            "customId": "guangzhou",
            "customName": "广州保税区",
            "customsRegionCode": "5141",
            "customsRegionName": null,
            "ccProvider": "010021",
            "venderName": "INCOROYTRADELIMITED个人护理海外专营店",
            "ccProviderName": "VIE伟世博",
            "phone": "",
            "email": "1029883657@qq.com",
            "sellerRecord": "10084463187057",
            "customRecord": "09010290",
            "qiRecord": "09010290",
            "taxNumberPost": "09010290",
            "postRate": 10,
            "country": "305",
            "qiCountry": "305",
            "measurement": "012",
            "qiMeasurement": "012",
            "isTaxFloat": 0,
            "legalUnit1": "035",
            "legalAmount1": "0.00300",
            "legalUnit2": "011",
            "legalAmount2": "1.00000",
            "gno": null,
            "delivery": "中国香港",
            "dutiablePrice": null,
            "ext1": null,
            "ext2": null,
            "operator": "13998334",
            "created": 1702006684000,
            "modified": 1702986383000,
            "modifiedMap": null,
            "clearType": null,
            "skuType": null,
            "type": 0,
            "mainSkuId": null,
            "vsp": null,
            "mfnTariff": "5",
            "penaltyTariff": "13",
            "isPlantPackage": null
        }
        info = {...info1}
        for (const k in info) {
            info[k] = encodeURIComponent(info[k])
        }
        const res = await fetch("https://shop-hk.jd.com/popRecording/recorded/changeRecording.do", {
            "headers": {
                "accept": "*/*",
                "accept-language": "zh-CN,zh;q=0.9,en;q=0.8",
                "content-type": "application/x-www-form-urlencoded; charset=UTF-8",
                "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"macOS\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "same-origin",
                "x-requested-with": "XMLHttpRequest",
                // "cookie": "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; thor=6901B38FCABE2222F893FE4DA6A41AD2B7B0C890E50CD438CE70BC24E947BA5C74C62E09C0A0D0A20A7CCFE5D0A04A5D6A305B0189BF1DB012876E697BD7A9F1C25C33FB5C7D8232F7C988F93B071792F075969C4EB68244AC3D47514DB51535261E0DC5F6E20CE450E59D18E6E7A983493D50B5BE48D3413E1D73BC53BE64D061B8505DFCE5AC4C8A3CFD0D336BA931; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; flash=2_ahn-HIMjFzg6gJaPiIiDr7fYvR5BkPzay-flyLklbZnw23kGkAPsX7sE7Bl-ZBivLG6zF5Hun6RMc6AtT6OQS5YudZiSpzZ7XNou97izdho*; ceshi3.com=000; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; TrackID=1eJakqOiiu7wAcmYygNZHWjPKiJPhQBiCiXDaFs6kzXOX_UMTTN1hvfe6V2MBgjxq; smb_track=68FA65B2AC0940C580281397D309CBF3; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; cn=0; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMTJL3GFYAAAAADNLQB5PBUZY27AX; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFMPE2E4JNGURJMD6BG2WHDMBHT4EQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU; __jda=34491710.1700109613209731139267.1700109613.1703401863.1703405033.10; __jdb=34491710.3.1700109613209731139267|10.1703405033; __jdc=34491710; shshshfpb=AAspC2pqMEpILfXnDP1RQdOco4vsSWBcDNClSQwAAAAA",
                "Referer": `https://shop-hk.jd.com/popRecording/recorded/queryById.do?recorded=true&id=${info.id}`,
                "Referrer-Policy": "strict-origin-when-cross-origin",
                "cookie": this.JDCookies
            },
            "body": `goodsPicture=&goodsData=&goodsAttach=&id=${info.id}&customId=${info.customId}&customsRegionCode=${info.customsRegionCode}&ccProviderName=${info.ccProviderName}&customModel=${info.customModel}&venderName=${info.venderName}&venderId=${info.venderId}&eclpCode=${info.eclpCode}&skuId=${info.skuId}&type=${type}&taxCommitmentsway=${info.taxCommitmentsway}&upc=${info.upc}&emgSkuId=&goodsName=${info.goodsName}&goodsNameEn=${info.goodsNameEn}&brand=${info.brand}&brandEn=${info.brandEn}&xingHao=${info.xingHao}&spe=${info.spe}&unit=${info.unit}&goodsSellerPrice=${info.goodsSellerPrice}&grossWeight=${info.grossWeight}&netWeight=${info.netWeight}&actualWeight=&volume=&safeDays=&salesWebSite=&hsCode=${info.hsCode}&hgsbys=${info.hgsbys}&function=${info.function}&use=${info.use}&composition=${info.composition}&vatRate=${info.vatRate}&taxRate=0&originCountry=${info.originCountry}&originArea=${info.originArea}&manufacturer=${info.manufacturer}&roduceAddress=&supplier=&note=&mfnTariff=${info.mfnTariff}&penaltyTariff=${info.penaltyTariff}&phone=${info.phone}&email=${info.email}&eclpName=${info.eclpName}&ccProvider=${info.ccProvider}`,
            "method": "POST"
        }).then(d => d.json());
        if (res.result.success) {
            this.logger.info(`备案状态修改成功; 商品：${info1.goodsName}; skuId: ${info.skuId}`, type);
            // this.sendFeiShu(info1, type)
        } else {
            this.logger.info(`备案状态修改失败; 商品：${info1.goodsName}; skuId: ${info.skuId}`, JSON.stringify(res.result), type);
        }
        return res.result.success;
    }
    // 判断暂停列表存在sku
    stopListHasSku(skuId) {
        for (const item of this.stopList) {
            const orderItems = item.orderItems;
            if (item.orderStatus === -4 || !item.isPhoneOrder) {
                continue;
            }
            const hasSku = orderItems.some(j => j.skuId == skuId || j.mainSkuId == skuId);
            if(hasSku) {
                return true
            }
        }
        return  false
    }


   async checkLogin() {
       try {
           const res = await fetch("https://porder.shop.jd.com/order/orderlist", {
               "headers": {
                   "accept": "application/json, text/plain, */*",
                   "accept-language": "zh-CN,zh;q=0.9,en;q=0.8",
                   "content-type": "application/json;charset=UTF-8",
                   "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
                   "sec-ch-ua-mobile": "?0",
                   "sec-ch-ua-platform": "\"macOS\"",
                   "sec-fetch-dest": "empty",
                   "sec-fetch-mode": "cors",
                   "sec-fetch-site": "same-origin",
                   cookie: this.JDCookies,
                   // "cookie": "shshshfpa=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; shshshfpx=44e010ae-b994-5292-d604-85a49c6a806d-1611905242; __jdu=1700109613209731139267; __jdv=76161171|direct|-|none|-|1703342303715; areaId=15; ipLoc-djd=15-1213-0-0; PCSYCityID=CN_330000_330100_0; _tp=WWkrE5q1uaY3bnuvPN7mC0Jy7Qj98SqryFRfDnmAGXBfj3EZkqYEdCCNPQpAbAri; pinId=Mk_A6Nbv7MenkDneLmJDcA; _pst=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; unick=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; pin=%E5%86%B0%E5%86%B0%E5%B0%8F%E5%BA%97111; user-key=8d21ce0f-8695-4c7e-835e-a2fc50c50830; corpBehavior=1; 3AB9D23F7A4B3CSS=jdd03OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLUAAAAMMUOJ4NGQAAAAADSDP22VJIM6GNMX; cn=1; smb_track=E36463B1BA744C75803892A14AFFF0A9; language=zh_CN; __USE_NEW_PAGEFRAME__=false; __USE_NEW_PAGEFRAME_VERSION__=v9; chat.jd.com=20170206; TrackID=1eKDqnXkB0cCNjshjVGs7kkRuDN5_Qha45E8IfuM0IyGXJFm6xN_gwllHHQ4ocw_w; ceshi3.com=000; flash=2_3Vf3TU1oOHS1E3iLb5mioPPwrQ-L6JvcRzupMoYFEjuZidy3aoJAiw6EkDNkfqvzrWbw1ymxXXb9Xid3ms_lM599f059_YoIpxgLpMYfYkp*; thor=6901B38FCABE2222F893FE4DA6A41AD28B2FF5A6B6F54A76F64CA788BC1404FA432D8014F1CA9DE928F379133D2969B553703BE185EF1FD6649B263A5EA1B9472C6558C7D6FE5CD726F9BF383E4E4570D054429AC8A045F0B45922B76DF266888E87D583C7DF1F76D301771EF3F104D797CDE992C8421711685C97D73408EC5147BF2E12DEF84BD9DEDF129C6C483F90; _vender_=TNK3O6PALVQGGMI642LJKJZPNN56IZEONGC7GL4VVDUXDFCCPPZQLPMTKJILMAPLCVF5BI7BM6KSTB3TNH3PMYY5YAALDGQXK7G2A7QXSDNOYW6CAGCLDWEQCPKGC3KUGVRB646PDVLYUQI3BDJ566XYIWJK3BINEVNTZU4XPHS7MGPM3IRXP3KQCYUEFTMPHRWL6CUN7T6NJ73NKFWGRSQYITLV2HHO3WE5JGLOWXRT3TAPTQSGGNICGAJHKSRTNTSC54R6Q4CXGZB2XWZYYTWTKUI23OXFVXEK3PE6BHKXEXJ5ZBTE7AQ4DRO7SJ75N23E6IGHEDQCT72I5345J2I36SSU434I7P6CY7EB2AEQ7LYOCV7OPGUYC4YKELPF3MGRB5OZSQZPV5DBDCN2OVVT3WHFGAZIBXIZMBNTMAJCDBGXFURYZVWQPSCD3VDHMYA4TRS3V45TKL5WWCWLZJGL3O3E5ZV4ATZXW4SB4DJLYX2W5LCD463NVMESRXHGU7GPWC3OZ52TBSZVWNCCHLV74FF3X42RWEHORBFKVKO32KKWLMWICL5FHXUEAUU7DLZ7R7TMBK7WVVS3WBDRRYD2QA22CEXPI3DTY7JDOMGER4JRG54GG4GSVXV6ABW2A3EP2IIDQ3SSPF25JGU5EUCCQ4J6ZPZ4Z664WWOW5OSLBNGLDSIVWKEXWCXDLZI5OWDAMBXZDZNIDXXBMRK4DRDPSI; b-sec=H7A3ZVYOXG5O6CIG7HQL4J7UIHCOAOXSWXVJGQ2SINZCR5RT55BV5YF3H32UFC4S; mba_muid=1700109613209731139267; universityLanguage=zh_CN; xue_userTypeCookieName50b60fba08fddfff319d0b5acc9d6eee=\"{\\\"1\\\":\\\"POP\\\"}\"; xue_userTypePageCookieName50b60fba08fddfff319d0b5acc9d6eee=1; qid_uid=63fbf91a-2193-4141-8127-0b5a9a4da60e; qid_fs=1703595716678; qid_ls=1703595716678; qid_ts=1703595716684; qid_vis=1; qid_sid=63fbf91a-2193-4141-8127-0b5a9a4da60e-1; qid_seq=3; _base_=YKH2KDFHMOZBLCUV7NSRBWQUJPBI7JIMU5R3EFJ5UDHJ5LCU7R2NILKK5UJ6GLA2RGYT464UKXAI4Z6HPCTN4UQM3WHVQ4ENFP57OC675CBWSP3REU42YTAQTNJUDXURTCNE6YVKRXISUFXTDU7V3U7QL2S3GKYL2ZCNGXSSG4SOQWCP5WPWO6EFS7HEHMRWVKBRVHB33TFD46QKR5DC3ZOXYJJSMQ7LPFV7Q42XNFW3B6USLKSP4DOKX736ZCQKMJCPUFAFUHXCAGBCJZTXPG55TUBDTGHQHRURVFOSH3SMBJJZ724NH6RPUBSC6X23EQXZ6XDSAY7EABH3APEXJ2C7MDIZP2K6O4UWVEXBLKE677BPFI2A; _vender_new_=GI63BGTJFDBQ5VFYRAGXDIUTOUGBH4IELSA4HBAE7MB4S5HIL5QMHN2LMW7LKWD43YCKHJGXPJWTPRAEQ2QTFLJHKJUFHCXGGYIHCD7WSWY4PLU54NT3HGWB4MCDSKE4VJSCWBCJJ3C6Z2VI46TWP7ZJBWNTMPWIQ77NXK4VVKW6ABLW3LCTHZEYXQSC5L6SULQYZLAOLYQIKX2KPA4NEI5RHY4F2FAXI5CPTHP6BXFL757MRIFGERH2CQC2D3RAAFDYIVNI7B7NTLXWX5NEUT7IONYJQA2GVEUHKGHLAXO2JD6UI7C57LRQ4MAILLWECXYYZ2YLJ5HVL6HMAVKWPNRUQV7VQ4TJYKV2GUTU42R6YB2W5VZ3XQXEWKPWY7U37DONKSVFDJCTM5HGUPWAOVXNOO54FZFST5WH5G3YCCF5H6RHZCCNDAPJ5WDJVY2XHWD7VVNICVT7PTKMSBW33L3BBSATV65XAXG72Z3QJ45MXA6IP2XQELXE7F47VC57UTM3EBWFRS7SWZCFQ5TPOT46JIQ6PNSYVA4453VSW4EAUWK6FRG3WAOQPSHG6BYFS7IG5ZCONS7EQAHSIUWPVDMBEDVBVCXW7ZSOG2U73QD4GGSJJ64QEOMY6A6GSGUVTIRL5UKNZLFIKJJT4PULCS3CSE; shshshfpb=AAsaEOaaMEpILfXnDP1RQdOco4vsSWBcDNClSTgAAAAA; _BELONG_CLIENT_=WPSC4XJXWK5USS4JNZY2X7VRLR5MCBKRSVHEXABGTHDGISIQK5YOLZUXYE7IOIM7MOKO74H6CRN6WHAAR4TMDV3XZWMXZRCRT5XRNE3V356BTOB2Y7LPK66VWQK6HPTGWVXIDXDCPVE3W5WMHAIO6AT2LX2XXVNUCXR34ZWFK6HY45CORGIKOSYDYZBF27WOKTUX6BS4FZMIJWNUX6CB4JAA25ZLF7ZEKYOO4QV5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BMTUJZACIBHXQFAVLRF76VQY5PNJGGJNBEZHSFYYJA3YORRT7FB5AHCOIFQKF3W5RWNUX6CB4JAA26JNMO7AYWNUPZF5HTSBXGNRM3E242MBI6V5D4C5VJDQ3EOYCOW5BWZDKMOJ5BS6II53ERY6ALV3ZWPF42L4CPUHEGPYIII35KDC4FCNVCORCXFD6IVNLBEDPB2GGP4UHWNRUDOQBDIW7RZJXBA2WV5ANZOTEGUCDWYRVQS2YUTIZNZ276PRYG4N56V6YTII7MBKBC7LYHO7C555HTSBXGNRM3E466AYN67DHWVM5HQFJ4NFDO5BSO5SF7ZNRNQMVBPEQMCXU26RC4Q; __jda=191429163.1700109613209731139267.1700109613.1703581530.1703595081.28; __jdc=191429163; __jdb=191429163.42.1700109613209731139267|28.1703595081; 3AB9D23F7A4B3C9B=OGIXHURWL4W2YOBLDZKWX2VSTPUXUVFYH3HXSX6VWZ4MSS2JDBQWZMFRLY5X3GAAGK5NRR2F5XYUYPKWK4MHQUTQLU",
                   "Referer": "https://porder.shop.jd.com/order/orderlist/suspend?t=1703664899837",
                   "Referrer-Policy": "strict-origin-when-cross-origin"
               },
               "body": "{\"current\":1,\"pageSize\":10,\"sortName\":\"desc\",\"orderId\":\"\",\"skuName\":\"\",\"orderCreateDateRange\":[],\"orderCompleteDateRange\":[],\"receiverName\":\"\",\"receiverTel\":\"\",\"userPin\":\"\",\"skuId\":\"\",\"logiNo\":\"\",\"paymentType\":\"\",\"orderType\":\"\",\"orderSource\":\"\",\"deliveryType\":\"\",\"storeId\":\"\",\"huoHao\":\"\",\"orderStatusArray\":[],\"o2oStoreIds\":null,\"provinceIds\":[],\"orderTag\":null,\"selectedTabName\":\"suspend\"}",
               "method": "POST"
           }).then(d => {
               try {
                   return d.json()
               } catch (e) {
                   return d.text()
               }
           });
           if (Array.isArray(res.orderList)) {
               return true
           } else {
               return false
           }
       } catch (e) {
           console.log(e, 'error--- checkLOgin')
           return false
       }
    }

    async sendFeiShu(info1, type) {
        const now = dayjs().format('YYYY-MM-DD hh:mm:ss') // '25/01/2019'

        let card = {
            "header": {
                "title": {
                    "tag": "plain_text",
                    "content": `监测暂停订单-商品备案状态修改通知`
                },
                "template": "red"
            },
            "elements": [
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": `**原因**`
                    }
                },
                {
                    "tag": "note",
                    "elements": [
                        {
                            "tag": "plain_text",
                            "content": `跳出新订单`
                        }
                    ]
                },
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": "**订单商品&skuId** "
                    },
                    "fields": [
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": ''
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": `商品sku名称${info1.skuName} 订单号: ${info1.orderId};
                                 付款时间: ${info1.paymentConfirmTime}; 主备案商品名称${info1.goodsName}; 主备案skuId: ${info1.skuId}`
                            }
                        }
                    ]
                },
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": "**目前备案状态** "
                    },
                    "fields": [
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": ''
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": `${type?"是": '否'} - ${now}`
                            }
                        }
                    ]
                }
            ]
        }
        const webhook = 'https://open.feishu.cn/open-apis/bot/v2/hook/3e1ae178-a3cb-4ea9-b3f2-29d650c14731';

        const options = {
            method: 'POST',
            url: webhook,
            json: true,
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            dataType: 'json',
            body: {
                msg_type: 'interactive',
                card
            }
        };
        await rp(options);
    }

    async jumpSendFeiShu(info1, type) {
        const now = dayjs().format('YYYY-MM-DD hh:mm:ss') // '25/01/2019'

        let card = {
            "header": {
                "title": {
                    "tag": "plain_text",
                    "content": `监测暂停订单-商品备案状态修改通知`
                },
                "template": "red"
            },
            "elements": [
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": `**原因**`
                    }
                },
                {
                    "tag": "note",
                    "elements": [
                        {
                            "tag": "plain_text",
                            "content": `订单从暂停跳出`
                        }
                    ]
                },
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": "**订单信息&skuId** "
                    },
                    "fields": [
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": ''
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": `商品sku名称${info1.skuName} 订单号: ${info1.orderId};
                                 付款时间: ${info1.paymentConfirmTime}; 主备案商品名称${info1.goodsName}; 主备案skuId: ${info1.skuId}`
                            }
                        }
                    ]
                },
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": "**目前备案状态** "
                    },
                    "fields": [
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": ''
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": `${type?"是": '否'} - ${now}`
                            }
                        }
                    ]
                }
            ]
        }
        const webhook = 'https://open.feishu.cn/open-apis/bot/v2/hook/3e1ae178-a3cb-4ea9-b3f2-29d650c14731';

        const options = {
            method: 'POST',
            url: webhook,
            json: true,
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            dataType: 'json',
            body: {
                msg_type: 'interactive',
                card
            }
        };
        await rp(options);
    }

    async logoutNotify(data) {
        const now = dayjs().format('YYYY-MM-DD hh:mm:ss') // '25/01/2019'

        let card = {
            "header": {
                "title": {
                    "tag": "plain_text",
                    "content": `京东接口访问异常通知-线程${this.thread}`
                },
                "template": "red"
            },
            "elements": [
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": `****`
                    }
                },
                {
                    "tag": "note",
                    "elements": [
                        {
                            "tag": "plain_text",
                            "content": `${JSON.stringify(data)}`
                        }
                    ]
                },
                {
                    "tag": "div",
                    "text": {
                        "tag": "lark_md",
                        "content": "**当前时间** "
                    },
                    "fields": [
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": ''
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": `${now}`
                            }
                        }
                    ]
                }
            ]
        }
        const webhook = 'https://open.feishu.cn/open-apis/bot/v2/hook/3e1ae178-a3cb-4ea9-b3f2-29d650c14731';

        const options = {
            method: 'POST',
            url: webhook,
            json: true,
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            dataType: 'json',
            body: {
                msg_type: 'interactive',
                card
            }
        };
        await rp(options);
    }


}

@Provide()
export class JDMainService {
    constructor() {
        this.init()
        setInterval(() => {
            this.init()
        }, 10000)
    }

    // _threadPool = {
    //     1
    // }

    _hash = {}

    @Inject()
    jdService: JDService

    init() {
        const stringData = fs.readFileSync('data.json', 'utf-8');
        const data = JSON.parse(stringData);
        Object.keys(data).forEach(async (item: string) => {
            if (!this._hash[item]) {
                if (data[item]) {
                    this._hash[item] = new JDService(data[item])
                    this._hash[item].JDCookies = data[item]
                    this._hash[item].thread = item
                }
            } else {
                this._hash[item].JDCookies = data[item]
                console.log('更新jd cookies成功')

                const isLogin = await this._hash[item].checkLogin();
                if(!isLogin) {
                    console.log(`线程${item}, 访问京东接口异常`)
                }
                if(!this._hash[item].JDCookies) {
                    delete this._hash[item]
                }
            }
        })
    }



}
